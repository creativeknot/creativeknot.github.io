const p={};function E(t){p.context=t}function j(){return{...p.context,id:`${p.context.id}${p.context.count++}-`,count:0}}const V=(t,e)=>t===e,w={equals:V};let O=H;const f=1,x=2,k={owned:null,cleanups:null,context:null,owner:null};var i=null;let h=null,l=null,o=null,a=null,d=0;function z(t,e){const s=l,n=i,r=t.length===0,u=r?k:{owned:null,cleanups:null,context:null,owner:e||n},c=r?t:()=>t(()=>g(()=>m(u)));i=u,l=null;try{return v(c,!0)}finally{l=s,i=n}}function B(t,e){e=e?Object.assign({},w,e):w;const s={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},n=r=>(typeof r=="function"&&(r=r(s.value)),F(s,r));return[D.bind(s),n]}function $(t,e,s){const n=C(t,e,!1,f);b(n)}function J(t,e,s){O=Q;const n=C(t,e,!1,f),r=N&&T(i,N.id);r&&(n.suspense=r),n.user=!0,a?a.push(n):b(n)}function U(t,e,s){s=s?Object.assign({},w,s):w;const n=C(t,e,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=s.equals||void 0,b(n),D.bind(n)}function g(t){const e=l;l=null;try{return t()}finally{l=e}}function K(t,e){const s=Symbol("context");return{id:s,Provider:q(s),defaultValue:t}}function X(t){let e;return(e=T(i,t.id))!==void 0?e:t.defaultValue}function G(t){const e=U(t),s=U(()=>A(e()));return s.toArray=()=>{const n=s();return Array.isArray(n)?n:n!=null?[n]:[]},s}let N;function D(){const t=h;if(this.sources&&(this.state||t))if(this.state===f||t)b(this);else{const e=o;o=null,v(()=>S(this),!1),o=e}if(l){const e=this.observers?this.observers.length:0;l.sources?(l.sources.push(this),l.sourceSlots.push(e)):(l.sources=[this],l.sourceSlots=[e]),this.observers?(this.observers.push(l),this.observerSlots.push(l.sources.length-1)):(this.observers=[l],this.observerSlots=[l.sources.length-1])}return this.value}function F(t,e,s){let n=t.value;return(!t.comparator||!t.comparator(n,e))&&(t.value=e,t.observers&&t.observers.length&&v(()=>{for(let r=0;r<t.observers.length;r+=1){const u=t.observers[r],c=h&&h.running;c&&h.disposed.has(u),(c&&!u.tState||!c&&!u.state)&&(u.pure?o.push(u):a.push(u),u.observers&&L(u)),c||(u.state=f)}if(o.length>1e6)throw o=[],new Error},!1)),e}function b(t){if(!t.fn)return;m(t);const e=i,s=l,n=d;l=i=t,I(t,t.value,n),l=s,i=e}function I(t,e,s){let n;try{n=t.fn(e)}catch(r){t.pure&&(t.state=f,t.owned&&t.owned.forEach(m),t.owned=null),P(r)}(!t.updatedAt||t.updatedAt<=s)&&(t.updatedAt!=null&&"observers"in t?F(t,n):t.value=n,t.updatedAt=s)}function C(t,e,s,n=f,r){const u={fn:t,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:i,context:null,pure:s};return i===null||i!==k&&(i.owned?i.owned.push(u):i.owned=[u]),u}function y(t){const e=h;if(t.state===0||e)return;if(t.state===x||e)return S(t);if(t.suspense&&g(t.suspense.inFallback))return t.suspense.effects.push(t);const s=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<d);)(t.state||e)&&s.push(t);for(let n=s.length-1;n>=0;n--)if(t=s[n],t.state===f||e)b(t);else if(t.state===x||e){const r=o;o=null,v(()=>S(t,s[0]),!1),o=r}}function v(t,e){if(o)return t();let s=!1;e||(o=[]),a?s=!0:a=[],d++;try{const n=t();return M(s),n}catch(n){o||(a=null),P(n)}}function M(t){if(o&&(H(o),o=null),t)return;const e=a;a=null,e.length&&v(()=>O(e),!1)}function H(t){for(let e=0;e<t.length;e++)y(t[e])}function Q(t){let e,s=0;for(e=0;e<t.length;e++){const n=t[e];n.user?t[s++]=n:y(n)}for(p.context&&E(),e=0;e<s;e++)y(t[e])}function S(t,e){const s=h;t.state=0;for(let n=0;n<t.sources.length;n+=1){const r=t.sources[n];r.sources&&(r.state===f||s?r!==e&&y(r):(r.state===x||s)&&S(r,e))}}function L(t){const e=h;for(let s=0;s<t.observers.length;s+=1){const n=t.observers[s];(!n.state||e)&&(n.state=x,n.pure?o.push(n):a.push(n),n.observers&&L(n))}}function m(t){let e;if(t.sources)for(;t.sources.length;){const s=t.sources.pop(),n=t.sourceSlots.pop(),r=s.observers;if(r&&r.length){const u=r.pop(),c=s.observerSlots.pop();n<r.length&&(u.sourceSlots[c]=n,r[n]=u,s.observerSlots[n]=c)}}if(t.owned){for(e=0;e<t.owned.length;e++)m(t.owned[e]);t.owned=null}if(t.cleanups){for(e=0;e<t.cleanups.length;e++)t.cleanups[e]();t.cleanups=null}t.state=0,t.context=null}function W(t){return t instanceof Error||typeof t=="string"?t:new Error("Unknown error")}function P(t){throw t=W(t),t}function T(t,e){return t?t.context&&t.context[e]!==void 0?t.context[e]:T(t.owner,e):void 0}function A(t){if(typeof t=="function"&&!t.length)return A(t());if(Array.isArray(t)){const e=[];for(let s=0;s<t.length;s++){const n=A(t[s]);Array.isArray(n)?e.push.apply(e,n):e.push(n)}return e}return t}function q(t,e){return function(n){let r;return $(()=>r=g(()=>(i.context={[t]:n.value},G(()=>n.children))),void 0),r}}let R=!1;function Y(){R=!0}function Z(t,e){if(R&&p.context){const s=p.context;E(j());const n=g(()=>t(e||{}));return E(s),n}return g(()=>t(e||{}))}export{J as a,Z as b,B as c,K as d,$ as e,z as f,Y as g,p as s,X as u};
